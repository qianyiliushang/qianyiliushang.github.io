---
title: 接口测试分享- 接口测试的作用及介入时机
date: 2016-06-06 17:13:47
tags: 测试, 接口
categories: 测试, 接口
---

在前面有写过[自动化测试的职级定义](http://qianyiliushang.github.io/2016/05/18/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%BA%A7%E5%88%AB%E5%AE%9A%E4%B9%89/)，其中有提到接口测试，可能好多没做过接口测试的人觉得接口测试是不是很神秘，甚至有些开发也不明白你接口测试到底在测什么，有什么用，好吧，那就先简单讲一讲为啥要做接口测试以及什么时候做接口测试吧。

<!-- more -->

## 分层测试思想

其实分层测试也不是最近两年提出来的，但是还是要先放到前面聊一聊。![分层测试](http://o86koa12m.bkt.clouddn.com/testLayer.png)

* 单元测试
在这里，我们可以看到，单元测试是放在最底部的(这个图是用PPT画的，轻点喷)，其在测试中所起的作用应该是最大的，只有开发人员他自己才知道自己写的代码哪里可能会出问题。然而现实情况是，很多开发人员没时间或者不愿意或者不会做单元测试，代码写完了，找工具调一下，通了，OK，任务完成。

* 接口测试
既然我们无法左右开发人员的行为，那么中间和集成测试/接口测试的任务自然而然落到测试人员的肩上。这一块相对来讲，投资回报比还可以，操作及维护都比较简单，收益的话也还不错(后面会讲)。

* UI测试
金字塔的顶部是UI测试，UI是呈现给终端用户面前的，所以不管什么公司都要求用户体验好(随之而来的就是各种改版、新技术或者框架的应用、需求调整)，这就导致了UI的变动非常的频繁(我这里指的是app，当然web应用也差不太多)。记得那年我还很年轻，以为做到UI自动化测试就到顶了...现在我最抵触的反而是UI自动化测试虽然我也是通过UI自动化进而深入到自动化测试的各个方面。那么说说为什么我会抵触做UI自动化吧，首先，就我的经验而言，自动化脚本维护成本太高，可能最开始写case，运行，CI都没问题，但是随着版本的迭代，维护已有的case就会变得很烦琐，即便你用了PO模式或者BDD。另一方面，很多人不懂测试，觉得自动化测试就是把人做的事情让机器去做，其实他们更多的是去思考我为什么要做自动化，做自动化能给我带来什么好处，付出的成本(时间，人力)与收益是否匹配等。

上面说了这么多，并不是说UI自动化测试不再需要，要量力而为，你的产品要适合做(这个适合也因人而异，一般主要就是产品稳定运营，有资源去编写维护脚本等)。做过UI自动化的应该都会知道，UI自动化一般不是用来发现问题的，而是做回归用的。而接口测试或者单元测试则可以去发现一些业务逻辑或者代码逻辑上的问题。

## 接口测试的主要目的

* 保证接口逻辑的正确性
在通过不同的入参可能会得到不同的响应信息，这部分在UI测试时，客户端已经限制了一些操作，你所有的测试都是基于开发正确的调用了api的前提下。
* 保证系统的可用性
* 接口向前兼容
* 提高客户端/服务端的联调效率
如果接口测试全都通过，那么客户端在跟服务端联调时，只需要去调api，并根据返回结果做相应的处理即可，不用担心接口返回的数据对不对，接口的异常处理有没有做到位。另一个方面来讲，可能接口提供方和接口调用方分属不同的部门(事业部、公司)，如果联调过程中出了问题，那么沟通成本将会很高。

## 接口测试的关注点
* 接口性能，单个接口处理业务/数据所用的时间，涉及算法及代码优化
* 接口健壮性，不论接口调用方输入什么样的参数，都可以正确处理，确保系统不会因为接口的不合理调用不崩溃
* 业务逻辑正确性，确保接口的返回与预期的结果一致
* 接口安全性，涉及接口请求的权限认证，序列化协议等
* 接口可用性，包括接口请求方法、格式控制，异常处理机制，超时处理等

当然，不同的接口实现方式可能还需要一些其它的关注点，这些都是基于设计良好的[restful api](https://en.wikipedia.org/wiki/Representational_state_transfer)

## 软件开发中不可避免的问题 - 重构

下图是一个典型的系统结构![system arch](http://o86koa12m.bkt.clouddn.com/blog/interface/workflow.pngworkflow.png)

某天，负责维护Service A的程序猿完成了手头上的工作，想看看整个服务运行的情况，发现系统运行效率越来越低，长时间的运行，系统也打了好多补丁，刚好最近学了某个新技术，那我就把一些代码重构了吧。而在另一边，用户突然发现某个功能不好使了，于是跑去找客户端开发人员，客户端说这部分代码我没动过啊，是不是后台服务动了，又去找依赖服务的开发人员，此时service B的开发人员一脸的萌B样说，我也没动过代码，如果他们都对自己的代码有信心，可能就去找依赖的ServiceA问问情况，否则就埋头看代码，查看scm代码提交纪录了。。。

此时，如果Service B的接口有过测试，在daily build的时候可能会发现某些接口调不通了或者说返回的数据格式变掉了，那么不用等到用户去发现问题，Service B很快就会定位到问题的所在。

当然上面只是假设的一种场景，现实中，Service A可能是一些三放的开放平台接口，也可能是集团公司的一些公共服务，他们做的一些变更一般很难实时的通知到接口调用方。

## 何时介入接口测试

### 一般的软件开发测试流程

![devflow](http://o86koa12m.bkt.clouddn.com/blog/interface/devflow.png)
上图是一种典型的敏捷开发流程，所有的节点都按计划有序进行。些时，如果要加入接口测试，显然是在软件测试阶段。看起来好像没什么问题，但是如果在测试阶段发现接口存在一些问题，如果问题比较大，那么可能会导致客户端返工，版本发布延迟等。如果是小问题，相应的开发人员可能已经开始下一个版本的迭代了，又要回过头来查看、解决上个版本的问题，节奏会乱掉。

### 接口测试移到开发阶段

那么为了解决上面的问题，我们把接口测试向前移到开发阶段。如果把软件开发这个环节再细分，可分为服务端开发，客户端开发，客户端跟服务端联调这三个阶段。理想的情况如下图：![devphase](http://o86koa12m.bkt.clouddn.com/devphase.png)
我们希望客户端开发跟服务端开发能够并行进行，由于客户端依赖服务端接口，可能先写UI层面的东西，最后等服务端开发完，再把依赖的接口补上，同时跟服务端去联调。在这样的流程中，接口测试最好在联调前介入并完成。

### 如果测试想跟开发并行呢

这种流程是最理想的，可大大提高软件的开发效率，同时也是要求最高的。看图：![devtest](http://o86koa12m.bkt.clouddn.com/blog/interface/devtest.png)

这个流程的第一步，就是开发(客户端服务端)测试对接口协议达成共识，搭建mock服务，然后就可以并行开发了：服务端去编写接口的业务逻辑，客户端编写展示层，并在依赖服务端的地方直接调mock接口，测试人员根据接口文档去编写用例并调用mock接口进行测试，当一切都完成后，替换掉mock数据，此时对客户端跟测试来说都是透明的了。细节就不再细说了，有兴趣参考一下[美团的mock设计](http://tech.meituan.com/mock-server-in-action.html)

## 接口测试所带来的好处

讲了这么多，那么做接口测试的好处或者优势有哪些呢？

* 前面讲到接口测试的目的及关注点
* 更可靠的持续集成
* 维护成本低
* 简单、高效

